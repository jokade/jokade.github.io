
<!doctype html>














<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/assets/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/assets/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/assets/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="tutorial,scala-native,gtk+," />





  <link rel="alternate" href="/atom.xml" title="jokade" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?v=5.1.1" />
















<meta name="description" content="A small example that shows how idiomatic bindings to Gtk+ can be accomplished in Scala Native.">
<meta name="keywords" content="tutorial, scala-native, gtk+">
<meta property="og:type" content="article">
<meta property="og:title" content="Object-Oriented Scala Native Bindings to Gtk+">
<meta property="og:url" content="/scala%20native/2018/01/10/idiomatic-gtk-bindings-for-scalanative/">
<meta property="og:site_name" content="jokade">
<meta property="og:description" content="A small example that shows how idiomatic bindings to Gtk+ can be accomplished in Scala Native.">
<meta property="og:locale" content="en">
<meta property="og:image" content="/assets/images/posts/2018-01-10/screenshot.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Object-Oriented Scala Native Bindings to Gtk+">
<meta name="twitter:description" content="A small example that shows how idiomatic bindings to Gtk+ can be accomplished in Scala Native.">
<meta name="twitter:image" content="/assets/images/posts/2018-01-10/screenshot.png">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href=""/>



<link href=/assets/css/mermaid.css rel="stylesheet" type="text/css">

  <title>Object-Oriented Scala Native Bindings to Gtk+</title>
  
















</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jokade</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">trials & errors</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

<div id="posts" class="posts-expand">
  
  

  

  
  
  

  <article class="post post-type- " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="/scala%20native/2018/01/10/idiomatic-gtk-bindings-for-scalanative/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jokade">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="assets/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jokade">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
          
          
            Object-Oriented Scala Native Bindings to Gtk+
          
        </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-10T00:00:00+01:00">
                2018-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/Scala%20Native" itemprop="url" rel="index">
                    <span itemprop="name">Scala Native</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
            
          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/assets/images/posts/2018-01-10/screenshot.png" rel="gallery_"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/assets/images/posts/2018-01-10/screenshot.png" itemprop="contentUrl"/>
              </a>
            
          

          
          
          </div>
        </div>
      

      
        <!-- A small example that shows how idiomatic bindings to [Gtk+](http://www.gtk.org) can be achieved in [Scala Native](http://www.scala-native.org).-->

<p>Alright, that’s not too impressive… but it’s sufficient to explore the basic concepts required to make an object-oriented
<a href="http://www.scala-native.org">Scala Native</a> binding to <a href="http://www.gtk.org">Gtk+</a>.</p>

<h2 id="example-in-c">Example in C</h2>
<p>Here’s what this example looks like in C:</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;gtk/gtk.h&gt;
</span>
<span class="c1">// callback used to close the window and exit the application
</span><span class="k">static</span> <span class="kt">void</span> <span class="n">destroy</span> <span class="p">(</span><span class="n">GtkWidget</span><span class="o">*</span><span class="p">,</span> <span class="n">gpointer</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="n">GtkWidget</span> <span class="o">*</span><span class="n">window</span><span class="p">,</span> <span class="o">*</span><span class="n">label</span>
  
  <span class="n">gtk_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">argc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">argv</span><span class="p">);</span>
  
  <span class="cm">/* Create and configure main window */</span>
  <span class="n">window</span> <span class="o">=</span> <span class="n">gtk_window_new</span><span class="p">(</span><span class="n">GTK_WINDOW_TOPLEVEL</span><span class="p">);</span>
  <span class="n">gtk_window_set_title</span><span class="p">(</span><span class="n">GTK_WINDOW</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="s">"Hello Scala Native!"</span><span class="p">);</span>
  <span class="n">gtk_container_set_border_width</span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
  <span class="n">gtk_widget_set_size_request</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
  
  <span class="cm">/* Connect the main window to the 'destroy' signal.
   * This signal is emitted when we click on the window 'close' button. */</span>
  <span class="n">g_signal_connect</span><span class="p">(</span><span class="n">G_OBJECT</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="s">"destroy"</span><span class="p">,</span> <span class="n">G_CALLBACK</span><span class="p">(</span><span class="n">destroy</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  
  <span class="cm">/* Create a label */</span>
  <span class="n">label</span> <span class="o">=</span> <span class="n">gtk_label_new</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
  <span class="n">gtk_label_set_markup</span><span class="p">(</span><span class="s">"&lt;span size='large'&gt;Hello Scala Native!&lt;/span&gt;"</span><span class="p">);</span>
  
  <span class="cm">/* Add the label as a child of the window */</span>
  <span class="n">gtk_container_add</span><span class="p">(</span><span class="n">GTK_CONTAINER</span><span class="p">(</span><span class="n">window</span><span class="p">),</span> <span class="n">label</span><span class="p">);</span>
  
  <span class="cm">/* Display window and all of its descendants */</span>
  <span class="n">gtk_widget_show_all</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
  
  <span class="cm">/* Enter main loop */</span>
  <span class="n">gtk_main</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">destroy</span><span class="p">(</span><span class="n">GtkWidget</span><span class="o">*</span> <span class="n">widget</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">gtk_main_quit</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
</div>

<p>If you’re not familiar with Gtk+, here are some explanations:</p>
<ul>
  <li>
    <p>First we must initialize the library. In doing so, we can pass the command line arguments to Gtk+
which then will automatically handle all recognized arguments and remove them from the <code class="highlighter-rouge">argv</code> array.</p>
  </li>
  <li>
    <p>Next we create a new toplevel window, set the window title, the border width (an inner padding between window
border and its child), and request a preferred window size. We need the calls to <code class="highlighter-rouge">GTK_WINDOW()</code> and <code class="highlighter-rouge">GTK_CONTAINER()</code><sup><a href="#fc7d:fn:1" class="footnote" id="fc7d:fn-back:1">1</a></sup> 
to cast <code class="highlighter-rouge">window</code> to the expected type.</p>
  </li>
  <li>
    <p>Then we register an event handler (Gtk+ calls them “signals”) so that we can exit the application when the user clicks
on the window close button.</p>
  </li>
  <li>
    <p>We create a new label to display some text (using Pango markup language, which is similar to HTML), and add the new label
as child to our window.</p>
  </li>
  <li>
    <p>Finally we set all widgets to be visible and enter enter Gtk+ main event loop. Note that this loop won’t exit
until we call <code class="highlighter-rouge">gtk_main_quit</code>, which happens in our <code class="highlighter-rouge">destroy</code> callback.</p>
  </li>
</ul>

<h2 id="create-object-oriented-bindings">Create Object-Oriented Bindings</h2>
<h3 id="the-gtk-c-api">The Gtk+ C API</h3>
<p>Since Gtk+ is a pure C library, we can easily create an <code class="highlighter-rouge">@extern</code> binding object for it and then
translate the example above line by line to Scala Native, e.g.:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scalanative.native._</span>

<span class="nd">@extern</span>
<span class="k">object</span> <span class="nc">gtk</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">gtk_init</span><span class="o">(</span><span class="n">argc</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">argv</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">CString</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">gtk_window_new</span><span class="o">(</span><span class="n">windowType</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">gtk_window_set_title</span><span class="o">(</span><span class="n">window</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span> <span class="n">title</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">gtk_container_set_border_width</span><span class="o">(</span><span class="n">container</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span> <span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">gtk._</span>
  
  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">gtk_init</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="kc">null</span><span class="o">)</span>   
    
    <span class="k">val</span> <span class="n">window</span> <span class="k">=</span> <span class="n">gtk_window_new</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="n">gtk_window_set_title</span><span class="o">(</span><span class="n">window</span><span class="o">,</span> <span class="n">c</span><span class="s">"Hello Scala Native"</span><span class="o">)</span>
      <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>However, Gtk+ is an object-oriented library<sup><a href="#fc7d:fn:2" class="footnote" id="fc7d:fn-back:2">2</a></sup>: we have some global functions (<code class="highlighter-rouge">gtk_init</code>, <code class="highlighter-rouge">gtk_main</code>),
but the bulk are either</p>
<ul>
  <li>object constructors (<code class="highlighter-rouge">gtk_window_new</code>, <code class="highlighter-rouge">gtk_label_new</code>),</li>
  <li>or operate on a previously created object, which is always passed as the first argument to the function
(<code class="highlighter-rouge">gtk_window_set_title</code>, <code class="highlighter-rouge">gtk_container_set_border_width</code>, …). These are nothing else than instance methods in Scala,
with the exception of the different call syntax.</li>
</ul>

<p>The naming conventions of Gtk+ indicate on which type of object a function operates. Obviously, there are
objects of type <code class="highlighter-rouge">GtkWindow</code> and <code class="highlighter-rouge">GtkLabel</code> (we can construct both using a corresponding <code class="highlighter-rouge">_new</code> function). Furthermore,
 since we can cast a <code class="highlighter-rouge">GtkWindow</code> to a <code class="highlighter-rouge">GtkContainer</code> and then call <code class="highlighter-rouge">gtk_container_set_border_width</code> on it,
 <code class="highlighter-rouge">GtkWindow</code> seems to be a subtype of <code class="highlighter-rouge">GtkContainer</code>. And both, <code class="highlighter-rouge">window</code> and <code class="highlighter-rouge">label</code> are <code class="highlighter-rouge">GtkWidget</code>s (we know that since
 they were declared as such in the C example :).</p>

<p>Actually, <code class="highlighter-rouge">GtkWidget</code> is not the immediate parent of <code class="highlighter-rouge">GtkWindow</code> and `GtkLabel. Here’s their full genealogy:</p>

<script src="/assets/js/mermaid/mermaid.min.js"></script>
<div class="mermaid">
graph TD
  GObject[GObject *] --&gt; GInitiallyUnowned
  GInitiallyUnowned --&gt; GtkObject
  GtkObject --&gt; GtkWidget[GtkWidget *]
  GtkWidget --&gt; GtkContainer[GtkContainer *]
  GtkWidget --&gt; GtkMisc
  GtkContainer --&gt; GtkBin
  GtkBin --&gt; GtkWindow[GtkWindow *]
  GtkMisc --&gt; GtkLabel[GtkLabel *]
</div>

<p>We’ll only consider the types marked with *, and ignore the rest of them for this example.</p>

<p>There’s one more function in our example, that takes an object as its first argument: <code class="highlighter-rouge">g_signal_connect()</code> registers an
event handler for any <code class="highlighter-rouge">GObject</code>. Hence, despite it’s name prefix <code class="highlighter-rouge">g_signal_</code>, we can consider it as an instance method of `GObject.</p>

<h3 id="modelling-the-gtk-types-in-scala">Modelling the Gtk+ Types in Scala</h3>
<p>Since we’re using Scala, we want to get rid of that nasty casting business, so let’s make that Gtk+ type hierarchy
explicit in Scala. Here’s what a first draft of our Scala API to Gtk+ could look like:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code>
<span class="nd">@extern</span>
<span class="k">object</span> <span class="nc">Gtk</span> <span class="o">{</span>
  <span class="nd">@name</span><span class="o">(</span><span class="s">"gtk_init"</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">init</span><span class="o">(</span><span class="n">argc</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">argv</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">CString</span><span class="o">]])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="nd">@name</span><span class="o">(</span><span class="s">"gtk_main"</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="nd">@name</span><span class="o">(</span><span class="s">"gtk_main_quit"</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">mainQuit</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">GObject</span> <span class="o">{</span>
  <span class="c1">// In GObject, the c_handler actually receives 2 args: the pointer to the object that received the signal,
</span>  <span class="c1">// and the pointer to a user-defined data object (which may be null)
</span>  <span class="k">def</span> <span class="n">signalConnect</span><span class="o">(</span><span class="n">detailed_signal</span><span class="k">:</span> <span class="kt">CString</span><span class="o">,</span> <span class="n">c_handler</span><span class="k">:</span> <span class="kt">CFunctionPtr0</span><span class="o">[</span><span class="kt">Unit</span><span class="o">],</span> <span class="n">data</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">])</span><span class="k">:</span> <span class="kt">UInt</span> <span class="o">=</span> <span class="o">???</span>
<span class="o">}</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">GtkWidget</span> <span class="k">extends</span> <span class="nc">GObject</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setSizeRequest</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">???</span>
  <span class="k">def</span> <span class="n">showAll</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">???</span>
<span class="o">}</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">GtkContainer</span> <span class="k">extends</span> <span class="nc">GtkWidget</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setBorderWidth</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">???</span>
  <span class="k">def</span> <span class="n">add</span><span class="o">(</span><span class="n">widget</span><span class="k">:</span> <span class="kt">GtkWidget</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">???</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">GtkWindow</span><span class="o">(</span><span class="n">windowType</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">GtkContainer</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setTitle</span><span class="o">(</span><span class="n">title</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">???</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">GtkLabel</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">GtkWidget</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setMarkup</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">???</span>
<span class="o">}</span>
</code></pre>
</div>
<p>You’ll notice that I’ve translated the snake_case function names to camelCase method names, and stripped the class suffix
from the names. All classes are abstract except <code class="highlighter-rouge">GtkWindow</code> and <code class="highlighter-rouge">GtkLabel</code>, which are the only ones we can actually
instantiate.</p>

<p>And here is the <code class="highlighter-rouge">main</code> of our example translated to this Scala API:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">object</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">Gtk</span><span class="o">.</span><span class="n">init</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span><span class="kc">null</span><span class="o">)</span>

    <span class="k">val</span> <span class="n">window</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GtkWindow</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="c1">// 0 = top level window
</span>    <span class="n">window</span><span class="o">.</span><span class="n">setTitle</span><span class="o">(</span><span class="n">c</span><span class="s">"Hello Scala Native!"</span><span class="o">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">setBorderWidth</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">setSizeRequest</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span>

    <span class="n">window</span><span class="o">.</span><span class="n">signalConnect</span><span class="o">(</span><span class="n">c</span><span class="s">"destroy"</span><span class="o">,</span> <span class="nc">CFunctionPtr</span><span class="o">.</span><span class="n">fromFunction0</span><span class="o">(</span><span class="n">destroy</span><span class="o">),</span> <span class="kc">null</span><span class="o">)</span>

    <span class="k">val</span> <span class="n">label</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">GtkLabel</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
    <span class="n">label</span><span class="o">.</span><span class="n">setMarkup</span><span class="o">(</span><span class="n">c</span><span class="s">"&lt;span size='large'&gt;Hello Scala Native!&lt;/span&gt;"</span><span class="o">)</span>

    <span class="n">window</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="n">label</span><span class="o">)</span>
    <span class="n">window</span><span class="o">.</span><span class="n">showAll</span><span class="o">()</span>

    <span class="nc">Gtk</span><span class="o">.</span><span class="n">main</span><span class="o">()</span>

  <span class="o">}</span>

  <span class="k">def</span> <span class="n">destroy</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">Gtk</span><span class="o">.</span><span class="n">mainQuit</span><span class="o">()</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="implement-bindings">Implement Bindings</h3>
<p>Let’s start with the binding implementation for <code class="highlighter-rouge">GtkLabel</code>. We’d like to use it as a normal Scala class and
create new instances using the <code class="highlighter-rouge">new</code> operator. To this end we need to call <code class="highlighter-rouge">gtk_label_new()</code> from the primary constructor.
But what should we do with the instance pointer returned by the C function? We need to store it with our scala instance,
since we must pass it back to Gtk+ every time we call an instance method on our object.</p>

<p>One solution to this problem is to replace the currently defined primary constructor with one that takes the C pointer
as its only argument, and then define a secondary constructor that has the parameter signature of <code class="highlighter-rouge">gtk_label_new</code>:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Ref</span>

<span class="k">class</span> <span class="nc">GtkLabel</span> <span class="k">private</span><span class="o">(</span><span class="k">val</span> <span class="n">ref</span><span class="k">:</span> <span class="kt">Ref</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">GtkWidget</span> <span class="o">{</span>
  <span class="k">def</span> <span class="k">this</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span> <span class="k">=</span> <span class="k">this</span><span class="o">(</span><span class="nc">GtkLabel</span><span class="o">.</span><span class="n">gtk_label_new</span><span class="o">(</span><span class="n">str</span><span class="o">).</span><span class="n">cast</span><span class="o">[</span><span class="kt">Ref</span><span class="o">])</span>
  <span class="k">def</span> <span class="n">setMarkup</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">???</span>
<span class="o">}</span>
<span class="nd">@extern</span>
<span class="k">object</span> <span class="nc">GtkLabel</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">gtk_label_new</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="n">extern</span>
<span class="o">}</span>
</code></pre>
</div>
<p>This snippet requires some explanations:</p>
<ul>
  <li>
    <p>We put all external declarations for a Gtk+ “class” in its companion object.</p>
  </li>
  <li>
    <p>The type of the external C reference <code class="highlighter-rouge">ref</code> to our Gtk+ object is a special marker trait <code class="highlighter-rouge">Ref</code>,
not <code class="highlighter-rouge">Ptr[Byte]</code> (as one would expect, since the return type of <code class="highlighter-rouge">gtk_label_new()</code> is <code class="highlighter-rouge">Ptr[Byte]</code>).
The reason for this becomes clear when we consider the signature of the secondary constructor: it takes one argument
of type <code class="highlighter-rouge">CString</code>. But <code class="highlighter-rouge">CString</code> is an alias for <code class="highlighter-rouge">Ptr[Byte]</code> – so we would have two constructors with identical
signatures (which is not possible, of course). Hence the special marker trait <code class="highlighter-rouge">Ref</code>, which we know will never occur in
the signatures of the C API.</p>
  </li>
  <li>
    <p>We make the primary constructor private to avoid accidentially using it directly.</p>
  </li>
</ul>

<p>The implementation of the instance method <code class="highlighter-rouge">setMarkup</code> is then straightforward:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GtkLabel</span> <span class="k">private</span><span class="o">(</span><span class="k">val</span> <span class="n">ref</span><span class="k">:</span> <span class="kt">Ref</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">GtkWidget</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="k">def</span> <span class="n">setMarkup</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="nc">GtkLabel</span>
    <span class="o">.</span><span class="n">gtk_label_set_markup</span><span class="o">(</span><span class="n">ref</span><span class="o">.</span><span class="n">cast</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]],</span><span class="n">str</span><span class="o">)</span>
<span class="o">}</span>
<span class="nd">@extern</span>
<span class="k">object</span> <span class="nc">GtkLabel</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="k">def</span> <span class="n">gtk_label_set_markup</span><span class="o">(</span><span class="n">self</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span> <span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Next we implement the parent class <code class="highlighter-rouge">GtkWidget</code>, where we don’t define the special primary constructor, but instead declare
an abstract <code class="highlighter-rouge">ref</code>:</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">abstract</span> <span class="k">class</span> <span class="nc">GtkWidget</span> <span class="k">extends</span> <span class="nc">GObject</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">ref</span><span class="k">:</span> <span class="kt">Ref</span>
  
  <span class="k">def</span> <span class="n">setSizeRequest</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="nc">GtkWidget</span>
    <span class="o">.</span><span class="n">gtk_widget_set_size_request</span><span class="o">(</span><span class="n">ref</span><span class="o">.</span><span class="n">cast</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]],</span><span class="n">width</span><span class="o">,</span><span class="n">height</span><span class="o">)</span>
    
  <span class="k">def</span> <span class="n">showAll</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="nc">GtkWidget</span><span class="o">.</span><span class="n">gtk_widget_show_all</span><span class="o">(</span><span class="n">ref</span><span class="o">.</span><span class="n">cast</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]])</span>
<span class="o">}</span>
<span class="nd">@extern</span>
<span class="k">object</span> <span class="nc">GtkWidget</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">gtk_widget_set_size_request</span><span class="o">(</span><span class="n">self</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span> <span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">gtk_widget_show_all</span><span class="o">(</span><span class="n">self</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>
</code></pre>
</div>
<p>The implementation for <code class="highlighter-rouge">GtkContainer</code> is analogous, with one notable exception: in the <code class="highlighter-rouge">add()</code> method we must
pass the C <code class="highlighter-rouge">ref</code> of the widget to Gtk+, not the Scal aobject (which is the reason we made <code class="highlighter-rouge">ref</code> a public <code class="highlighter-rouge">val</code>):</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">abstract</span> <span class="k">class</span> <span class="nc">GtkContainer</span> <span class="k">extends</span> <span class="nc">GtkWidget</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">ref</span><span class="k">:</span> <span class="kt">Ref</span>
  <span class="k">def</span> <span class="n">setBorderWidth</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="nc">GtkContainer</span>
    <span class="o">.</span><span class="n">gtk_container_set_border_width</span><span class="o">(</span><span class="n">ref</span><span class="o">.</span><span class="n">cast</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]],</span><span class="n">width</span><span class="o">)</span>
    
  <span class="k">def</span> <span class="n">add</span><span class="o">(</span><span class="n">widget</span><span class="k">:</span> <span class="kt">GtkWidget</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="nc">GtkContainer</span>
    <span class="o">.</span><span class="n">gtk_container_add</span><span class="o">(</span><span class="n">ref</span><span class="o">.</span><span class="n">cast</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]],</span> <span class="n">widget</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">cast</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]])</span>
<span class="o">}</span>
<span class="nd">@extern</span>
<span class="k">object</span> <span class="nc">GtkContainer</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">gtk_container_set_border_width</span><span class="o">(</span><span class="n">self</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span> <span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">gtk_container_add</span><span class="o">(</span><span class="n">self</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span> <span class="n">widget</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>
</code></pre>
</div>

<p>The implementation of <code class="highlighter-rouge">GObject.signalConnect</code> deviates from the standard pattern: <code class="highlighter-rouge">gtk_signal_connect</code> is actually
a macro in Gtk+, so we need to call <code class="highlighter-rouge">gtk_signal_connect_data</code> instead (which is what the C macro does):</p>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">abstract</span> <span class="k">class</span> <span class="nc">GObject</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">ref</span><span class="k">:</span> <span class="kt">Ref</span>
  <span class="c1">// In GObject, the c_handler actually receives 2 args: the pointer to the object that received the signal,
</span>  <span class="c1">// and the pointer to a user-defined data object (which may be null)
</span>  <span class="k">def</span> <span class="n">signalConnect</span><span class="o">(</span><span class="n">detailed_signal</span><span class="k">:</span> <span class="kt">CString</span><span class="o">,</span> <span class="n">c_handler</span><span class="k">:</span> <span class="kt">CFunctionPtr0</span><span class="o">[</span><span class="kt">Unit</span><span class="o">],</span>
                    <span class="n">data</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">])</span><span class="k">:</span> <span class="kt">UInt</span> <span class="o">=</span>
    <span class="nc">GObject</span><span class="o">.</span><span class="n">g_signal_connect_data</span><span class="o">(</span><span class="n">ref</span><span class="o">.</span><span class="n">cast</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]],</span><span class="n">detailed_signal</span><span class="o">,</span>
                                  <span class="n">c_handler</span><span class="o">,</span><span class="n">data</span><span class="o">,</span><span class="kc">null</span><span class="o">,</span><span class="mi">0</span><span class="o">)</span>
<span class="o">}</span>
<span class="nd">@extern</span>
<span class="k">object</span> <span class="nc">GObject</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">g_signal_connect_data</span><span class="o">(</span><span class="n">self</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span>
                            <span class="n">detailed_signal</span><span class="k">:</span> <span class="kt">CString</span><span class="o">,</span>
                            <span class="n">c_handler</span><span class="k">:</span> <span class="kt">CFunctionPtr0</span><span class="o">[</span><span class="kt">Unit</span><span class="o">],</span>
                            <span class="n">data</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span>
                            <span class="n">destroy_data</span><span class="k">:</span> <span class="kt">CFunctionPtr0</span><span class="o">[</span><span class="kt">Unit</span><span class="o">],</span>
                            <span class="n">connect_flags</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">UInt</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>
</code></pre>
</div>

<p>And we’re done! You can view the <a href="http://github.com/jokade/jokade.github.io/blob/master/code/posts/2018-01-10/manual/src/main/scala/main.scala">complete sample code</a>,
or checkout the <a href="https://github.com/jokade/jokade.github.io/blob/master/code/posts/2018-01-10">complete project</a> and
run it with <code class="highlighter-rouge">sbt manual/run</code>.</p>

<h2 id="generate-binding-code-automatically">Generate Binding Code Automatically</h2>
<p>Phew! Our example runs, but hacking in all that binding code is a little bit tedious, especially since most of it can be
derived from the class declaration using some simple rules. The experimental <a href="https://github.com/jokade/scalanative-obj-interop">scalanative-obj-interop</a>
project does exactly that. We just need to specify the interface to the Gtk+ types:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="nd">@CObj</span>
<span class="k">object</span> <span class="nc">Gtk</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">init</span><span class="o">(</span><span class="n">argc</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">argv</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Ptr</span><span class="o">[</span><span class="kt">CString</span><span class="o">]])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">mainQuit</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>

<span class="nd">@CObj</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">GObject</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">signalConnect</span><span class="o">(</span><span class="n">detailed_signal</span><span class="k">:</span> <span class="kt">CString</span><span class="o">,</span> <span class="n">c_handler</span><span class="k">:</span> <span class="kt">CFunctionPtr0</span><span class="o">[</span><span class="kt">Unit</span><span class="o">],</span>
                    <span class="n">data</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">])</span><span class="k">:</span> <span class="kt">UInt</span> <span class="o">=</span>
    <span class="n">signalConnectData</span><span class="o">(</span><span class="n">detailed_signal</span><span class="o">,</span><span class="n">c_handler</span><span class="o">,</span><span class="n">data</span><span class="o">,</span><span class="kc">null</span><span class="o">,</span><span class="mi">0</span><span class="o">)</span>

  <span class="nd">@name</span><span class="o">(</span><span class="s">"g_signal_connect_data"</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">signalConnectData</span><span class="o">(</span><span class="n">detailed_signal</span><span class="k">:</span> <span class="kt">CString</span><span class="o">,</span> <span class="n">c_handler</span><span class="k">:</span> <span class="kt">CFunctionPtr0</span><span class="o">[</span><span class="kt">Unit</span><span class="o">],</span>
                        <span class="n">data</span><span class="k">:</span> <span class="kt">Ptr</span><span class="o">[</span><span class="kt">Byte</span><span class="o">],</span> <span class="n">destroy_data</span><span class="k">:</span> <span class="kt">CFunctionPtr0</span><span class="o">[</span><span class="kt">Unit</span><span class="o">],</span>
                        <span class="n">connect_flags</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">UInt</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>

<span class="nd">@CObj</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">GtkWidget</span> <span class="k">extends</span> <span class="nc">GObject</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setSizeRequest</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">showAll</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>

<span class="nd">@CObj</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">GtkContainer</span> <span class="k">extends</span> <span class="nc">GtkWidget</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setBorderWidth</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
  <span class="k">def</span> <span class="n">add</span><span class="o">(</span><span class="n">widget</span><span class="k">:</span> <span class="kt">GtkWidget</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>

<span class="nd">@CObj</span>
<span class="k">class</span> <span class="nc">GtkWindow</span><span class="o">(</span><span class="n">windowType</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">GtkContainer</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setTitle</span><span class="o">(</span><span class="n">title</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>

<span class="nd">@CObj</span>
<span class="k">class</span> <span class="nc">GtkLabel</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">GtkWidget</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setMarkup</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">CString</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">extern</span>
<span class="o">}</span>
</code></pre>
</div>

<p>and the rest will be generated during compilation by the <code class="highlighter-rouge">@CObj</code> annotation.</p>

<p>If you like to try it, check out the <a href="http://github.com/jokade/jokade.github.io/blob/master/code/posts/2018-01-10">sample project</a>
and run <code class="highlighter-rouge">sbt generated/run</code>. If you’d lik to inspect the generated code, you can add a <code class="highlighter-rouge">@debug</code> annotation to a class,
and the expanded class + companion object are printed out to the console during compilation:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">de.surfice.smacrotools.debug</span>

<span class="nd">@CObj</span>
<span class="nd">@debug</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">GObject</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Of course, you don’t need to create the Gtk+ bindings yourself: the <a href="https://github.com/jokade/scalanative-gtk">scalantive-gtk project</a>
intends to provide bindings for GLib, Gtk+, and possibly other libraries from the GNOME project (but it’s still in a very early stage).</p>

<p><em>That’s it – have fun coding Gtk+ apps in Scala!</em></p>

<hr />
<ol class="footnotelist">
<li id="fc7d:fn:1" class="footnotebody" value="1">
  Actually, these are macros.
  <a href="#fc7d:fn-back:1" class="backlink">⏎</a></li>
<li id="fc7d:fn:2" class="footnotebody" value="2">
  Gtk+ is based on GObject, a pure C framework for object-oriented programming with single-inheritance classes.
  <a href="#fc7d:fn-back:2" class="backlink">⏎</a></li>
</ol>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            
            <a href="/tag/#/tutorial" rel="tag"># tutorial</a>
          
            
            <a href="/tag/#/scala-native" rel="tag"># scala-native</a>
          
            
            <a href="/tag/#/gtk%2B" rel="tag"># gtk+</a>
          
        </div>
      

      
      
      
      
      

      
      
      

      
    </footer>
  </article>

  <div class="post-spread">
    
  </div>
</div>


<div id="vanilla-comments"></div> <script type="text/javascript">
  /*** Required Settings: Edit BEFORE pasting into your web page ***/
  var vanilla_forum_url = 'http://surfice.de/vanilla/index.php?p=/'; // The full http url & path to your vanilla forum
  var vanilla_identifier = '/scala%20native/2018/01/10/idiomatic-gtk-bindings-for-scalanative'; // Your unique identifier for the content being commented on
  /*** Optional Settings: Ignore if you like ***/
// var vanilla_discussion_id = ''; // Attach this page of comments to a specific Vanilla DiscussionID.
  var vanilla_category_id = 'jokade-blog'; // Create this discussion in a specific Vanilla CategoryID.
  /*** DON'T EDIT BELOW THIS LINE ***/
  (function() {
    var vanilla = document.createElement('script');
    vanilla.type = 'text/javascript';
    var timestamp = new Date().getTime();
    vanilla.src = 'http://surfice.de/vanilla/js/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(vanilla); })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://vanillaforums.com/?ref_noscript">comments powered by Vanilla.</a></noscript>



          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        
        
        




      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/assets/images/avatar.gif"
               alt="jokade" />
          <p class="site-author-name" itemprop="name">jokade</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
        
        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              
              
              <span class="links-of-author-item">
                <a href="http://github.com/jokade" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            





            
              <div class="post-toc-content">
    <ol class=nav>
      <li class="nav-item nav-level-2"> <a class="nav-link" href="#example-in-c"> <span class="nav-number">1</span> <span class="nav-text">Example in C</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#create-object-oriented-bindings"> <span class="nav-number">2</span> <span class="nav-text">Create Object-Oriented Bindings</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#the-gtk-c-api"> <span class="nav-number">2.1</span> <span class="nav-text">The Gtk+ C API</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#modelling-the-gtk-types-in-scala"> <span class="nav-number">2.2</span> <span class="nav-text">Modelling the Gtk+ Types in Scala</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#implement-bindings"> <span class="nav-number">2.3</span> <span class="nav-text">Implement Bindings</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> </li></ol> </li></ol> </li></ol> </li></ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#generate-binding-code-automatically"> <span class="nav-number">3</span> <span class="nav-text">Generate Binding Code Automatically</span> </a> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child"> <ol class="nav-child">
    </ol>
  </div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>

        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jokade</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://jekyllrb.com">Jekyll</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/simpleyyt/jekyll-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





















  
   
  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/assets/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/motion.js?v=5.1.1"></script>



  
  

  <script type="text/javascript" src="/assets/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/assets/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/assets/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  




  

    

  





  






  

  

  
  


  

  

  

</body>
</html>

